<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tateti</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Lexend&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>Tatet√≠</h1>
    <div class="status" id="status">Turno de: X</div>
    <div id="board"></div>
    <div class="controls">
      <button class="btn-primary" id="restart">Reiniciar</button>
      <button class="btn-ghost" id="ai">Jugar vs CPU</button>
    </div>
  </div>

<script>
(() => {
  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('status');
  const restartBtn = document.getElementById('restart');
  const aiBtn = document.getElementById('ai');

  let board; // array 9: 'X' | 'O' | ''
  let turn;  // 'X' or 'O'
  let running = true;
  let vsAI = false;

  const WIN_COMBOS = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  function init() {
    board = Array(9).fill('');
    turn = 'X';
    running = true;
    renderBoard();
    updateStatus();
  }

  function renderBoard() {
    boardEl.innerHTML = '';
    for (let i=0;i<9;i++){
      const cell = document.createElement('div');
      cell.className = 'cell' + (board[i] ? ' disabled' : '');
      cell.dataset.index = i;
      cell.textContent = board[i];
      cell.addEventListener('click', onCellClick);
      boardEl.appendChild(cell);
    }
  }

  function onCellClick(e){
    const i = Number(e.currentTarget.dataset.index);
    if (!running || board[i]) return;
    makeMove(i, turn);
    if (running && vsAI && turn === 'O') {
      // after player's move, CPU moves (CPU is 'O')
      setTimeout(cpuMove, 250);
    }
  }

  function makeMove(i, player) {
    if (board[i] || !running) return;
    board[i] = player;
    // update DOM cell quickly
    const cell = boardEl.querySelector(`.cell[data-index="${i}"]`);
    if (cell) {
      cell.textContent = player;
      cell.classList.add('disabled');
    }

    if (checkWinner(player)) {
      statusEl.textContent = `Gana ${player} üéâ`;
      running = false;
      highlightWin(player);
      return;
    }
    if (board.every(x=>x)) {
      statusEl.textContent = "Empate";
      running = false;
      return;
    }
    turn = (player === 'X') ? 'O' : 'X';
    updateStatus();
  }

  function updateStatus() {
    statusEl.textContent = running ? `Turno de: ${turn}` : statusEl.textContent;
  }

  function checkWinner(player) {
    return WIN_COMBOS.some(combo => combo.every(idx => board[idx] === player));
  }

  function highlightWin(player) {
    // highlight the winning cells
    WIN_COMBOS.forEach(combo => {
      if (combo.every(idx => board[idx] === player)) {
        combo.forEach(idx => {
          const c = boardEl.querySelector(`.cell[data-index="${idx}"]`);
          if (c) c.style.background = '#fff5d6';
        });
      }
    });
  }

  function cpuMove() {
    if (!running) return;
    // Simple AI: try to win, block, else random
    const ai = 'O', human = 'X';

    // 1) can AI win?
    for (let i=0;i<9;i++){
      if (!board[i]) {
        board[i] = ai;
        if (checkWinner(ai)) {
          // commit move
          const cell = boardEl.querySelector(`.cell[data-index="${i}"]`);
          if (cell) { cell.textContent = ai; cell.classList.add('disabled'); }
          highlightWin(ai);
          statusEl.textContent = `Gana ${ai} üéâ`;
          running = false;
          return;
        }
        board[i] = '';
      }
    }
    // 2) block human
    for (let i=0;i<9;i++){
      if (!board[i]) {
        board[i] = human;
        if (checkWinner(human)) {
          board[i] = ai;
          const cell = boardEl.querySelector(`.cell[data-index="${i}"]`);
          if (cell) { cell.textContent = ai; cell.classList.add('disabled'); }
          if (checkWinner(ai)) { highlightWin(ai); statusEl.textContent = `Gana ${ai} üéâ`; running = false; return; }
          turn = human;
          updateStatus();
          return;
        }
        board[i] = '';
      }
    }
    // 3) take center if free
    if (!board[4]) {
      makeMove(4, ai);
      return;
    }
    // 4) random corner, then sides
    const corners = [0,2,6,8].filter(i=>!board[i]);
    if (corners.length) {
      makeMove(corners[Math.floor(Math.random()*corners.length)], ai);
      return;
    }
    const sides = [1,3,5,7].filter(i=>!board[i]);
    if (sides.length) {
      makeMove(sides[Math.floor(Math.random()*sides.length)], ai);
      return;
    }
  }

  restartBtn.addEventListener('click', init);
  aiBtn.addEventListener('click', () => {
    vsAI = !vsAI;
    aiBtn.textContent = vsAI ? 'Humano vs Humano' : 'Jugar vs CPU';
    init();
  });

  init();
})();
</script>
</body>
</html>
